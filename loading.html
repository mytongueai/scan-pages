<body>

  <!-- âœ… Logo -->
  <img src="https://raw.githubusercontent.com/mytongueai/assets/refs/heads/main/mytongueaiLogo.png" alt="MyTongueAI Logo" class="logo" />

  <!-- âœ… Headline + Spinner -->
  <h2>Hold on! Weâ€™re preparing your scan report...</h2>
  <div class="spinner"></div>

  <!-- âœ… Helpful message -->
  <p id="initialMsg">
    This page will automatically refresh once your scan is ready.  
    You can save this link and come back later if needed.
  </p>

  <!-- âœ… Dynamic fallback message (hidden by default) -->
  <div id="fallback" style="display:none;">
    <p class="bold">After 3 minutes with no result?</p>
    <p class="small">
      Please check your email â€” you should receive the full report there.<br />
      Still no email? Contact us:
      <br />
      ðŸ“§ <a href="mailto:support@mytongueai.com">support@mytongueai.com</a>
      <br />
      ðŸ“± <a href="tel:+17146237422">(714) 623-7422</a>
    </p>
  </div>

  <!-- âœ… Progress loader -->
  <style>
    .progress-bar {
      width: 80%;
      height: 10px;
      margin: 20px auto;
      background: #eee;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar-fill {
      width: 0%;
      height: 100%;
      background: #1976d2;
      animation: progressAnim 180s linear forwards;
    }
    @keyframes progressAnim {
      0% { width: 0%; }
      100% { width: 100%; }
    }
  </style>
  <div class="progress-bar"><div class="progress-bar-fill"></div></div>

  <!-- âœ… Autopoll script -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const scanId = params.get("id");
    const destinationURL = `https://mytongueai.github.io/scan-pages/scans/${scanId}.html`;

    const maxWaitTime = 180000; // 3 mins
    const checkInterval = 5000; // 5 sec
    let elapsed = 0;

    setTimeout(() => {
      document.getElementById('fallback').style.display = 'block';
    }, 5000);

    async function pollForScan() {
      try {
        const res = await fetch(destinationURL, { method: 'HEAD' });
        if (res.ok) {
          window.location.href = destinationURL;
          return;
        }
      } catch (e) {}

      elapsed += checkInterval;
      if (elapsed < maxWaitTime) {
        setTimeout(pollForScan, checkInterval);
      }
    }

    if (scanId) {
      pollForScan();
    } else {
      document.getElementById('initialMsg').innerText = "Missing scan ID. Please resubmit your scan.";
    }
  </script>

</body>
